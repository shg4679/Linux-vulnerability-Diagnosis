#!/bin/bash

while true :
        do
                echo "ACCOUNT START"
                ./moglog/moglog/account.sh
                echo "ACCOUNT END"
                echo ""

                echo "FILE START"
                ./moglog/moglog/file.sh
                echo "FILE END"
                echo ""

                echo "SERVICE START"
                ./moglog/moglog/service.sh
                echo "SERVICE END"
                echo ""

                echo "LOG START"
                ./moglog/moglog/log.sh
                echo "LOG END"
                break
        done


grep "양호" result.csv >> result.txt


count=0
count1=0
count2=0

while read -r line
do
    if echo "$line" | grep -q "상"; then
        count=$(($count+3))
    elif echo "$line" | grep -q "중"; then
        count1=$(($count1+2))
    else
        count2=$(($count2+1))
    fi

done < result.txt


if [ $((count+count1+count2)) -ge 141 ]; then
        echo -e "\n해당 시스템은 양호하다." >> result.csv
elif [ $((count+count1+count2)) -ge 101 ]; then
        echo -e "\n해당 시스템은 점검이 필요하다." >> result.csv
else
    echo -e "\n해당 시스템은 취약하다." >> result.csv
fi

echo "" >> result.csv

egrep '취약|점검' result.csv >> error.txt

./moglog/moglog/error.sh

rm -f result.txt
rm -f error.txt
