#!/bin/bash

#echo "항목 코드 U-05"

PH=$(echo $PATH | egrep "\.:|::|:.:")

if [ -z $PH ]; then
        echo "U-05 양호 상" >> result.csv
else
        echo "U-05 취약 상" >> result.csv
fi

#echo "항목 코드 U-06"

DIR=$(find / \( -nouser -o -nogroup \) -print 2>/dev/null)

if [ -z $DIR ]; then
        echo "U-06 양호 상" >> result.csv
else
        echo "U-06 취약 상" >> result.csv
fi

#echo "항목 코드 U-07"

PWD=$(ls -l /etc/passwd | awk '{print $3}')
PSWD=$(stat -c "%a" /etc/passwd)

if [ "$PWD" == "root" ]; then
        if [ $PSWD -le 644 ]; then
                echo "U-07 양호 상" >> result.csv
        else
                echo "U-07 취약 상" >> result.csv
        fi
else
        echo "U-07 취약 상" >> result.csv
fi

#echo "항목 코드 U-08"

S=/etc/shadow
SHA=$(ls -l $S | awk '{print $3}')
SHAD=$(stat -c "%a" $S)

if [ -e $S ]; then
        if [ "$SHA" == "root" ]; then
                if [ $SHAD -le 400 ]; then
                        echo "U-08 양호 상" >> result.csv
                else
                        echo "U-08 취약 상" >> result.csv
                fi
        else
                echo "U-08 취약 상" >> result.csv
        fi
else
        echo "U-08 점검 상" >> result.csv
fi

#echo "항목 코드 U-09"

H=/etc/hosts
HOST=$(ls -l $H | awk '{print $3}')
HOSTS=$(stat -c "%a" $H)

if [ -e $H ]; then
        if [ "$HOST" == "root" ]; then
                if [ $HOSTS -le 600 ]; then
                        echo "U-09 양호 상" >> result.csv
                else
                        echo "U-09 취약 상" >> result.csv
                fi
        else
                echo "U-09 취약 상" >> result.csv
        fi
else
        echo "U-09 점검 상" >> result.csv
fi

#echo "항목 코드 U-10"

X=/etc/xinetd.d
XID=$(ls -al $X | awk '{print $3}')
XIED=$(stat -c "%a" $X)

if [ -e $X ]; then
        if [[ "$XID" == *root* ]]; then
                if [ $XIED -eq 600 ]; then
                        echo "U-10 양호 상" >> result.csv
                else
                        echo "U-10 취약 상" >> result.csv
                fi
        else
                echo "U-10 취약 상" >> result.csv
        fi
else
        echo "U-10 점검 상" >> result.csv
fi

#echo "항목 코드 U-11"

SY=/etc/rsyslog.conf
SYS=$(ls -l $SY | awk '{print $3}')
RSYS=$(stat -c "%a" $SY)

if [ -e $SY ]; then
        if [ "$SYS" == 'root' ] || [ "$SYS" == 'bin' ] || [ "$SYS" == 'sys' ]; then
                if [[ $RSYS -le 640 ]]; then
                        echo "U-11 양호 상" >> result.csv
                else
                        echo "U-11 취약 상" >> result.csv
                fi
        else
                echo "U-11 취약 상" >> result.csv
        fi
else
        echo "U-11 점검 상" >> result.csv
fi

#echo "항목 코드 U-12"

SR=/etc/services
SER=$(ls -l $SR | awk '{print $3}')
SRVI=$(stat -c "%a" $SR)

if [ -e $SR ]; then
        if [ "$SER" == 'root' ] || [ "$SER" == 'bin' ] || [ "$SER" == 'sys' ]; then
                if [ $SRVI -le 644 ]; then
                        echo "U-12 양호 상" >> result.csv
                else
                        echo "U-12 취약 상" >> result.csv
                fi
        else
                echo "U-12 취약 상" >> result.csv
        fi
else
        echo "U-12 점검 상" >> result.csv
fi

#echo "항목 코드 U-13"

SID=$(ls -alL /sbin/dump /sbin/restore /sbin/unix_chkpwd /usr/bin/at /usr/bin/lpq /usr/bin/lpq-lpd /usr/bin/lpr /usr/bin/lpr-lpd /usr/bin/lprm /usr/bin/lprm-lpd /usr/bin/newgrp /usr/sbin/lpc /usr/sbin/lpc-lpd /usr/sbin/traceroute 2>/dev/null | awk '{print $1}' | grep -i 's' | wc -l)


if [ $SID -eq 0 ]; then
        echo "U-13 양호 상" >> result.csv
else
        echo "U-13 취약 상" >> result.csv
fi

#echo "항목코드 U-14"
echo "U-14 점검 상" >> result.csv

#echo "항목 코드 U-15"

find / -type f -perm -2 -exec ls –l {}\;> ww.txt 2>&1
if [ -e ww.txt ]; then
        echo "U-15 점검 상" >> result.csv
else
        echo "U-15 양호 상" >> result.csv
fi

#echo "항목 코드 U-16"

find /dev -type f -exec ls –l {}\; > dev.txt 2>&1
if [ -e dev.txt ];then
        echo "U-16 점검 상" >> result.csv
else
        echo "U-16 양호 상" >> result.csv
fi

#echo "항목 코드 U-17"

if [ -f "$HOME/.rhosts" ] || [ -f "/etc/hosts.equiv" ]; then
        echo "U-17 양호 상" >> result.csv
else
        echo "U-17 취약 상" >> result.csv
fi


#echo "항목코드 U-18"

if grep -q 'ALL: ALL' /etc/hosts.deny ; then
        echo "U-18 양호 상" >> result.csv
else
        echo "U-18 취약 상" >> result.csv
fi

#echo "항목코드 U-55"

hosts="/etc/hosts.lpd"

if [ -e "$hosts" ]; then
        hosts_owner=$(ls -l "$hosts" | awk '{print $3}')
        hosts_permissions=$(stat -c "%a" "$hosts")

        if [ "$hosts_owner" == "root" ]; then
                echo "U-55 양호 상" >> result.csv
        else
                echo "U-55 취약 상" >> result.csv
        fi
        if [ "$hosts_permissions" == "600" ]; then
                echo "U-55 양호 상" >> result.csv
        else
                echo "U-55 취약 상" >> result.csv
        fi
else
        echo "U-55 점검 상" >> result.csv
fi

#echo "항목코드 U-56"

umask_value=$(umask)
if (( umask_value <= 022 )); then
        echo "U-56 양호 중" >> result.csv
else
        echo "U-56 취약 중" >> result.csv
fi

#echo "항목코드 U-57"

home_directory="/home/$USER"
ls –ld "$home_directory" > /dev/null 2>&1

if [ $? -eq 0 ]; then
        owner=$(ls -ld "$home_directory" | awk '{print $3}')
        if [ "$owner" == "$USER" ]; then
                        echo "U-57 양호 중" >> result.csv
        else
                        echo "U-57 취약 중" >> result.csv
        fi

        others_write=$(ls -ld "$home_directory" | cut -c 9)
        if [ "$others_write" == "-" ]; then
                echo "U-57 취약 중" >> result.csv
        fi
else
        echo "U-57 점검 중" >> result.csv
fi

#echo "항목코드 U-58"

cat /etc/passwd |awk -F: '{print$1,$6}' > 33.txt
        echo "U-58 점검 중" >> result.csv

#echo "항목코드 U-59"

hidden_files=$(find / -type f -name ".*" /dev/null 2>&1)
hidden_directories=$(find / -type d -name ".*" /dev/null 2>&1)

if [[ -n "$hidden_files" || -n "$hidden_directories" ]]; then
        echo "U-59 점검 하" >> result.csv
else
        echo "U-59 양호 하" >> result.csv
fi
