#!/bin/bash

#echo "항목코드 U-19"

ls -lL /etc/xinetd.d |grep finger > /dev/null 2>&1

if [ $? -eq 0 ]; then
        echo "U-19취약 상" >> result.csv
else
        echo "U-19 양호 상" >> result.csv
fi

#echo "항목코드 U-20"

if [ -f /etc/vsftpd/vsftpd.conf ]; then
        if grep -q "ftp" /etc/vsftpd/vsftpd.conf; then
                echo "U-20 양호 상" >> result.csv
        else
                echo "U-20 취약 상" >> result.csv
        fi
else
        echo "U-20 점검 상" >> result.csv
fi

#echo "항목코드 U-21"

files=$(ls -alL /etc/xinetd.d/* /dev/null 2>&1 | egrep "rsh|rlogin|rexec" | egrep -v "grep|klogin|kshell|kexec")

if [ -n "$files" ]; then
        echo "U-21 취약 상" >> result.csv
else
        echo "U-21 양호 상" >> result.csv
fi

#echo "항목코드 U-22"

cron_file="/etc/crontab"
cron_owner=$(stat -c %U "$cron_file")
cron_permissions=$(stat -c %a "$cron_file")

if [[ "$cron_owner" = "root" && "$cron_permissions" = "640" ]]; then
        echo "U-22 양호 상" >> result.csv
else
        echo "U-22 취약 상" >> result.csv
fi

#echo "항목코드 U-23"

services=("chargen" "daytime" "echo" "discard")
files=$(ls –alL "/etc/xinetd.d/$services" /dev/null 2>&1 | grep disable)

if [ -n "$files"]; then
        echo "U-23 양호 상" >> result.csv
else
        echo "U-23 취약 상" >> result.csv
fi

#echo "항목코드 U-24"

NN='ps –ef | egrep "nfs|statd|lockd"' > /dev/null 2>&1

if [ "$NN" ]; then
        echo "U-24 취약 상" >> result.csv
else
        echo "U-24 양호 상" >> result.csv
fi

#echo "항목코드 U-25"
echo "U-25 점검 상" >> result.csv

#echo "항목코드 U-26"
#echo "automountd 제거"

ps -ef | grep automount 2>&1 /dev/null

if [ -n $? ];then
        echo "U-26 취약 상" >> result.csv
else
        echo "U-26 양호 상" >> result.csv
fi

#echo "항목코드 U-27"
echo "U-27 점검 상" >> result.csv

#echo "항목코드 U-28"

ps -ef | egrep "ypserv|ypbind|ypxfrd|rpc.yppasswdd|rpc.ypupdated" /dev/null 2>&1

if [ $? -eq 0 ];then
        echo "U-28 취약 상" >> result.csv
else
        echo "U-28 양호 상" >> result.csv
fi

#echo "항목코드 U-29"

if [ -f "/etc/xinetd.d/tftp" ] || [ -f "/etc/xinetd.d/talk" ]; then
        if grep -q "disable" "/etc/xinetd.d/tftp" || grep -q "disable" "/etc/xinetd.d/talk"; then
                echo "U-29 양호 상" >> result.csv
        else
                echo "U-29 취약 상" >> result.csv
        fi
else
        echo "U-29 점검 상" >> result.csv
fi


#echo "항목코드 U-30"

sendmail_version=$(ps -ef | grep sendmail)

if [[ -n "$sendmail_version" ]]; then
        echo "U-30 점검 상" >> result.csv
else
        echo "U-30 점검 상" >> result.csv
fi

#echo "항목코드 U-31"

ps -ef | grep sendmail | grep -v "grep" >/dev/null 2>&1

if [ $? -eq 0 ]; then
        cat $FILE | grep "R$\*" | grep "Relaying denied" | grep -v '#' >/dev/null 2>&1
        if [ $? -eq 0 ]; then
                echo "U-31 양호 상" >> result.csv
        else
                echo "U-31 취약 상" >> result.csv
        fi
else
        echo "U-31 양호 상" >> result.csv
fi


#echo "항목코드 U-32"

ps -ef | grep sendmail | grep -v "grep" > /dev/null 2>&1

if [ $? -eq 0 ];then
        grep -v '^*#' /etc/mail/sendmail.cf | grep PrivacyOptions >/dev/null 2>&1
        if [ $? -eq 0 ]; then
                echo "U-32 양호 상" >> result.csv
        else
                echo "U-32 취약 상" >> result.csv
        fi
else
        echo "U-32 양호 상" >> result.csv
fi

#echo "항목 코드 U-33"

if ps -ef | grep -q named; then
        echo "U-33 취약 상" >> result.csv
else
        echo "U-33 양호 상" >> result.csv
fi

#echo "항목 코드 U-34"

if [ 'ps -ef | grep -q named | grep -v "grep" | wc -l' == 0 ]; then
        echo "U-34 양호 상" >> result.csv
else
        if [ '-e /etc/named.conf' -o '-e /etc/named.boot' ]; then
                if [ 'cat /etc/named.conf | grep -q "\allow-transfer"' -o 'cat /etc/named.boot | grep -q "\xfrnets"' ]; then
                        echo "U-34 취약 상" >> result.csv
                fi
        else
                echo "U-34 양호 상" >> result.csv
        fi
fi

#echo "항목 코드 U-35"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ 'cat /etc/httpd/conf/httpd.conf | grep -qF "Indexes" | grep -v "#" | wc -l' == 0 ]; then
                echo "U-35 양호 상" >> result.csv
        else
                echo "U-35 취약 상" >> result.csv
        fi
else
        echo "U-35 점검 상" >> result.csv
fi

#echo "항목 코드 U-36"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ 'cat /etc/httpd/conf/httpd.conf | egrep "(User|Group)" | grep -v "#" | egrep -v "(UserDir|LogFormat)"' == 'root' ]; then
                echo "U-36 취약 상" >> result.csv
        else
                echo "U-36 양호 상" >> result.csv
        fi
else
        echo "U-36 점검 상" >> result.csv
fi

#echo "항목 코드 U-37"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ 'cat /etc/httpd/conf/httpd.conf | grep -qF "AllowOverride | grep -v "#"' == *None* ]; then
                echo "U-37 취약 상" >> result.csv
        else
                echo "U-37 양호 상" >> result.csv
        fi
else
        echo "U-37 점검 상" >> result.csv
fi

#echo "항목 코드 U-38"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ -e '/[Apache home]/htdocs/manual'] ||[ -e '/[Apache home]/manual' ]; then
                echo "U-38 취약 상" >> result.csv
        else
                echo "U-38 양호 상" >> result.csv
        fi
else
        echo "U-38 점검 상" >> result.csv
fi

#echo "항목 코드 U-39"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ 'cat /etc/httpd/conf/httpd.conf | grep -qF "FollowSymLinks" | grep -v "#" | wc -l' == 0 ]; then
                echo "U-39 양호 상" >> result.csv
        else
                echo "U-39 취약 상" >> result.csv
        fi
else    
        echo "U-39 점검 상" >> result.csv
fi

#echo "항목 코드 U-40"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ 'cat /etc/httpd/conf/httpd.conf | grep -qF "LimitRequestBody" | grep -v "#" | wc -l' == 0 ]; then
                echo "U-40 양호 상" >> result.csv
        else
                echo "U-40 취약 상" >> result.csv
        fi
else
        echo "U-40 점검 상" >> result.csv
fi

#echo "항목 코드 U-41"

if [ -e /etc/httpd/conf/httpd.conf ]; then
        if [ $(cat /etc/httpd/conf/httpd.conf | grep -qF "/usr/local/apache/htdocs" || grep -qF "/usr/local/apache2/htdocsf" || grep -qF "/var/www/html" | grep -v "#" | wc -l) -eq 0 ]; then
                echo "U-41 양호 상" >> result.csv
        else
                echo "U-41 취약 상" >> result.csv
        fi
else
        echo "U-41 점검 상" >> result.csv
fi

#echo "항목 코드 U-60"

if [ 'ps -ef | grep -q "sshd" | grep -v "grep" | wc -l' == 0 ]; then
        echo "U-60 점검 중" >> result.csv
else
        if [ 'ps -ef | grep -q "telnet" | grep -v "grep" | wc -l' == 1 ]; then
                echo "U-60 취약 중" >> result.csv
        else
                echo "U-60 양호 중" >> result.csv
        fi
fi

#echo "항목 코드 U-61"

if [ 'ps -ef | grep -q "ftp" | grep -v "grep" | wc -l' == 0 ]; then
        if [ 'ps -ef | egrep -q "vsftpd|proftp" | wc -l' == 0 ]; then
                echo "U-61 양호 하" >> result.csv
        else
                echo "U-61 취약 하" >> result.csv
        fi
else
        echo "U-61 취약 하" >> result.csv
fi

#echo "항목 코드 U-62"

if [ -e /etc/passwd ]; then
        if [ 'cat /etc/passwd | grep -q "false" | grep -v "root"' == 1 ]; then
                echo "U-62 양호 중" >> result.csv
        else
                echo "U-62 취약 중" >> result.csv
        fi
else
        echo "U-62 점검 중" >> result.csv
fi

#echo "항목 코드 U-63"

if [ -e /etc/ftpusers ]; then
        A=$(ls -l /etc/ftpusers | awk '{print $3}')
        AB=$(stat -c "%a" /etc/ftpusers)
        if [ "$A" == "root" ]; then
                if [ $AB -le 640 ]; then
                        echo "U-63 양호 하"
                else
                        echo "U-63 취약 하"
                fi
        else
                echo "U-63 취약 하"
        fi
else
        echo "U-63 점검 하" >> result.csv
fi

#echo "항목 코드 U-64"

if [ 'ps -ef | grep -q "ftp" | grep -v "grep" | wc -l' == 0 ]; then
        echo "U-64 양호 중" >> result.csv
else
        if [ 'cat /etc/ftpusers | grep "root" | grep -v '#'' == 0 ]; then
                echo "U-64 취약 중" >> result.csv
        else
                echo "U-64 양호 중" >> result.csv
        fi
fi

#echo "항목 코드 U-65"

if [ -e /etc/at.allow ]; then
        C=$(ls -l /etc/at.allow | awk '{print $3}')
        CD=$(stat -c "%a" /etc/at.allow)
        if [ "$C" == "root" ]; then
                if [ $CD -le 640 ]; then
                        echo "U-65 양호 중" >> result.csv
                else
                        echo "U-65 취약 중" >> result.csv
                fi
        else
                echo "U-65 취약 중" >> result.csv
        fi
else
        echo "U-65 점검 중" >> result.csv
fi

#echo "항목 코드 U-66"

if [ 'ps -ef | grep -q "snmp" | wc -l' == 0 ]; then
        echo "U-66 양호 중" >> result.csv
else
        echo "U-66 취약 중" >> result.csv
fi

#echo "항목 코드 U-67"

if [ -e /etc/snmp/snmpd.conf ]; then
        if [ 'cat /etc/snmp/snmpd.conf | egrep "public|private" | grep -v '#'' == 0 ]; then
                echo "U-67 양호 중" >> result.csv
        else
                echo "U-67 취약 중" >> result.csv
        fi
else
        echo "U-67 양호 중" >> result.csv
fi

#echo "항목 코드 U-68"
echo "U-68 점검 하" >> result.csv

#echo "항목 코드 U-69"

if [ -e /etc/dfs/dfstab ]; then
        E=$(ls -l /etc/at.allow | awk '{print $3}')
        EF=$(stat -c "%a" /etc/at.allow)
        if [ "$E" == "root" ]; then
                if [ $EF -le 640 ]; then
                        echo "U-69 양호 중" >> result.csv
                else
                        echo "U-69 취약 중" >> result.csv
                fi
        else
                echo "U-69 취약 중" >> result.csv
        fi
else
        echo "U-69 점검 중" >> result.csv
fi

#echo "항목 코드 U-70"

if [ -e /etc/mail/sendmail.cf ]; then
        if [ 'ps -ef | grep sendmail | grep -v grep' == 0 ]; then
                echo "U-70 양호 중" >> result.csv
        else
                if [ 'cat /etc/mail/sendmail | egrep "noexpn|novrfy"' == 0 ]; then
                        echo "U-70 취약 중" >> result.csv
                else
                        echo "U-70 양호 중" >> result.csv
                fi
        fi
else
        echo "U-70 양호 중" >> result.csv
fi

#echo "항목 코드 U-71"
if [ 'ps -ef | grep -q "httpd" | grep -v "grep" | wc -l' == 0 ]; then
        echo "U-71 양호 중" >> result.csv
else
        if [ 'cat /etc/httpd/conf/httpd.conf | grep -qi "ServerTokens" | wc -l' == 0 ]; then
                  echo "U-71 취약 중" >> result.csv
        elif [ 'cat /etc/httpd/conf/httpd.conf | grep -qi "ServerSignature" | wc -l' == 0 ]; then
                        echo "U-71 취약 중" >> result.csv
        else
                        echo "U-71 양호 중" >> result.csv
        fi
fi
